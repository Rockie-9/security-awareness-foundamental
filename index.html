<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PIP Training Deck: Securing Our Future — Refactored</title>

  <!-- Tailwind (quick dev CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React (UMD) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel for inline JSX (dev convenience) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide Icons UMD -->
  <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&family=JetBrains+Mono:wght@400;700&display=swap');

    :root {
      --bg: #020617;
      --muted: #94a3b8;
      --panel: #0b1220;
      --accent: #06b6d4;
    }

    html,body,#root { height:100%; }
    body {
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:#e2e8f0;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .font-mono { font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, monospace; }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .reduce-motion { animation: none !important; transition: none !important; }
    }

    /* subtle anims */
    @keyframes fadeIn { from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }
    .anim-fade { animation: fadeIn .35s ease-out both; }

    /* Custom scrollbar (non-essential) */
    ::-webkit-scrollbar { width:8px; height:8px; }
    ::-webkit-scrollbar-track { background:#071127; }
    ::-webkit-scrollbar-thumb { background:#334155; border-radius:6px; }
    ::-webkit-scrollbar-thumb:hover { background:#475569; }
  </style>
</head>
<body>
  <div id="root" class="h-full"></div>

  <script type="text/babel">
    (function(React, ReactDOM, lucideReact) {
      const { useState, useEffect, useRef, useCallback, useMemo } = React;
      const {
        Shield, Lock, Smartphone, UserX, AlertTriangle,
        Eye, Ear, Mic, Share2, Briefcase, Coffee,
        ChevronRight, ChevronLeft, CheckCircle, XCircle, X, Menu, Maximize, Minimize,
        LayoutGrid, FileText
      } = lucideReact || {};

      // --- Slide data (unchanged content, kept separate) ---
      const SLIDES = (() => {
        // keep original content but minimal here for brevity; user can expand
        return [
          { id:1, type:'title', title:'PIP IS LIFE', subtitle:'Professional Information Protection: A 24/7 Mindset', icon: <Shield className="w-16 h-16 text-cyan-400" />, script: 'Welcome... (shortened for sample)' },
          { id:2, type:'content', title:'The 24/7 Mindset', layout:'split', leftContent: (<div className="opacity-50 text-center"><div className="text-5xl font-bold line-through text-slate-400">9-to-5</div><p className="mt-2 text-slate-500">The Old Way</p></div>), rightContent:(<div className="text-center text-cyan-400"><div className="text-5xl font-bold animate-pulse">24/7</div><p className="mt-2 text-white">"You are the Perimeter."</p></div>), script:'PIP is a 24/7 mindset.'},
          { id:3, type:'content', title:'Global Security Management (GSM)', layout:'three-col', items:[ { title:'IT Security', icon:<Shield/>, desc:'Cyber Defense', color:'text-blue-400' }, { title:'Physical Security', icon:<Lock/>, desc:'Site Integrity', color:'text-green-400' }, { title:'PIP', icon:<UserX/>, desc:'People & Process', color:'text-purple-400' } ], script:'Three divisions...' },
          { id:4, type:'alert', title:'Trap #1: The Smart Device', icon:<Smartphone className="w-12 h-12 text-red-500"/>, list:['Personal Smart Phones','Unlisted Smart Watches','Smart Glasses','Docking Stations'], warning:'Forbidden: Recording, Storage, Transmission', script:'Do a self-check.'},
          // Add remaining slides as needed...
        ];
      })();

      const QUIZ = [
        { q:'A friend asks about a secret project. You trust them.', options:['Tell vaguely','Say nothing','Show a photo'], correct:1, hint:'Trust is not clearance.' },
        { q:'You have Smart Glasses. Wear inside?', options:['Yes if off','No','Only cafeteria'], correct:1, hint:'If it records, it stays out.' }
        // trimmed for the example
      ];

      // --- Utility hooks & functions ---
      function useFullscreenSync() {
        const [isFs, setIsFs] = useState(Boolean(document.fullscreenElement));
        useEffect(() => {
          const handler = () => setIsFs(Boolean(document.fullscreenElement));
          document.addEventListener('fullscreenchange', handler);
          return () => document.removeEventListener('fullscreenchange', handler);
        }, []);
        const toggle = async () => {
          try {
            if (!document.fullscreenElement) {
              await document.documentElement.requestFullscreen();
            } else {
              await document.exitFullscreen();
            }
            // state will sync via event listener
          } catch (err) { /* ignore user-cancelled */ }
        };
        return [isFs, toggle];
      }

      // small safe confirm replacement (uses window.confirm for simplicity)
      const safeConfirm = (msg) => window.confirm(msg);

      // --- Presentational Components ---
      function TopBar({ titleLabel, onToggleGrid, onToggleScript, showGrid, showScript, isFs, onToggleFs, slideInfo }) {
        return (
          <header className="h-14 border-b border-slate-800 flex items-center justify-between px-4 bg-slate-900 shrink-0" role="banner">
            <div className="flex items-center gap-2 text-cyan-400 font-bold tracking-widest text-sm">
              <Shield size={18}/> <span>{titleLabel}</span>
            </div>

            <nav className="hidden md:flex items-center gap-3" aria-label="presentation controls">
              <button title="Overview" onClick={onToggleGrid} className={`p-2 ${showGrid ? 'text-cyan-400' : 'text-slate-400'}`} aria-pressed={showGrid}><LayoutGrid size={20}/></button>
              <button title="Fullscreen" onClick={onToggleFs} className="p-2 text-slate-400">{isFs ? <Minimize size={20}/> : <Maximize size={20}/>}</button>
              <button title="Speaker notes" onClick={onToggleScript} className={`px-3 py-1 rounded text-sm font-mono border ${showScript ? 'bg-cyan-900 border-cyan-500 text-white' : 'border-slate-600 text-slate-500'}`}>{showScript ? 'HIDE SCRIPT' : 'SHOW SCRIPT'}</button>
              <div className="text-slate-500 font-mono text-sm">{slideInfo}</div>
            </nav>

            <div className="md:hidden flex items-center gap-2">
              <button onClick={onToggleGrid} className={`p-2 ${showGrid ? 'text-cyan-400' : 'text-slate-400'}`} aria-label="toggle grid"><LayoutGrid size={20}/></button>
              <button onClick={onToggleFs} className="p-2 text-slate-400" aria-label="toggle fullscreen">{isFs ? <Minimize size={20}/> : <Maximize size={20}/>}</button>
              <button onClick={onToggleScript} className="p-2 text-slate-400" aria-label="toggle script"><FileText size={20}/></button>
            </div>
          </header>
        );
      }

      function SlideFrame({ children }) {
        return <main className="flex-1 relative overflow-hidden">{children}</main>;
      }

      function SlideRenderer({ slide }) {
        if (!slide) return <div className="p-8">No slide</div>;
        // keep rendering logic tidy and small
        const type = slide.type;
        switch(type) {
          case 'title':
            return (
              <section className="h-full flex flex-col items-center justify-center text-center p-6 anim-fade">
                <div className="mb-6">{slide.icon}</div>
                <h1 className="text-4xl md:text-6xl font-black text-white">{slide.title}</h1>
                {slide.subtitle && <p className="mt-2 text-cyan-400">{slide.subtitle}</p>}
              </section>
            );
          case 'content':
            if (slide.layout === 'split') {
              return (
                <div className="flex flex-col md:flex-row h-full">
                  <div className="w-full md:w-1/2 p-6 border-b md:border-b-0 md:border-r border-slate-800">{slide.leftContent}</div>
                  <div className="w-full md:w-1/2 p-6">{slide.rightContent}</div>
                </div>
              );
            }
            if (slide.layout === 'three-col') {
              return (
                <div className="flex flex-col md:flex-row gap-6 items-stretch p-6">
                  {slide.items.map((it,i)=>(<div key={i} className="flex-1 bg-slate-800 p-6 rounded border border-slate-700 text-center"><div className={`${it.color}`}>{it.icon}</div><h3 className="text-white mt-3 font-bold">{it.title}</h3><p className="text-slate-400">{it.desc}</p></div>))}
                </div>
              );
            }
            return <div className="p-6">{slide.rightContent || slide.leftContent || <p>{slide.title}</p>}</div>;
          case 'alert':
            return (
              <div className="p-6 flex flex-col items-center justify-center gap-6">
                <div className="bg-red-500/10 p-6 rounded-full">{slide.icon}</div>
                <h2 className="text-2xl font-bold text-white">{slide.title}</h2>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full md:w-2/3">{slide.list?.map((x,i)=>(<div key={i} className="bg-slate-800 p-3 rounded text-center border-l-4 border-red-500 font-mono">{x}</div>))}</div>
                <div className="text-red-400 font-bold mt-6">{slide.warning}</div>
              </div>
            );
          default:
            return <div className="p-6">Unsupported slide type</div>;
        }
      }

      function GridOverview({ slides, current, onSelect, enterExam }) {
        return (
          <div className="h-full w-full p-6 overflow-auto">
            <h2 className="text-2xl font-bold mb-4">Slide Overview</h2>
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
              {slides.map((s,i)=>(
                <button key={s.id} onClick={()=>onSelect(i)} className={`p-4 rounded border ${i===current?'ring-2 ring-cyan-400':''} bg-slate-800 text-left`}>
                  <div className="flex items-center gap-3"><div className="text-cyan-400">{s.icon}</div><div><div className="font-bold text-white">{s.title}</div><div className="text-slate-400 text-sm">#{i+1}</div></div></div>
                </button>
              ))}
              <button onClick={enterExam} className="p-4 rounded border bg-slate-800 text-white">Final Exam</button>
            </div>
          </div>
        );
      }

      function Quiz({ questions, onFinish }) {
        const [index, setIndex] = useState(0);
        const [score, setScore] = useState(0);
        const [feedback, setFeedback] = useState(null);
        const q = questions[index];

        const handleAnswer = (i) => {
          if (feedback) return;
          const ok = i === q.correct;
          setFeedback({ ok, hint: q.hint });
          if (ok) setScore(s=>s+1);
          setTimeout(()=>{
            setFeedback(null);
            if (index < questions.length - 1) setIndex(idx=>idx+1);
            else onFinish(score + (ok?1:0));
          }, 1400);
        };

        return (
          <div className="p-6 max-w-3xl mx-auto">
            <div className="flex justify-between text-slate-400 font-mono text-sm mb-4"><span>ASSESSMENT MODE</span><span>Q{index+1}/{questions.length}</span></div>
            <h3 className="text-2xl font-bold mb-6">{q.q}</h3>
            <div className="grid gap-3">
              {q.options.map((opt,i)=>(<button key={i} onClick={()=>handleAnswer(i)} className="p-4 bg-slate-800 rounded text-left">{opt}</button>))}
            </div>
            <div role="status" aria-live="polite" className="mt-4">
              {feedback && (feedback.ok ? <div className="bg-green-600 p-3 rounded">Correct</div> : <div className="bg-red-600 p-3 rounded">Incorrect — Hint: {feedback.hint}</div>)}
            </div>
          </div>
        );
      }

      function App() {
        const [current, setCurrent] = useState(0);
        const [showScript, setShowScript] = useState(false);
        const [showGrid, setShowGrid] = useState(false);
        const [quizMode, setQuizMode] = useState(false);
        const [quizResult, setQuizResult] = useState(null);
        const [isFs, toggleFs] = useFullscreenSync();
        const mainRef = useRef(null);

        useEffect(() => {
          const handler = (e) => {
            if (e.key === 'ArrowRight') {
              e.preventDefault();
              if (!quizMode && !showGrid) setCurrent(c => Math.min(c+1, SLIDES.length-1));
            }
            if (e.key === 'ArrowLeft') {
              e.preventDefault();
              if (!quizMode && !showGrid) setCurrent(c => Math.max(c-1,0));
            }
            if (e.key.toLowerCase() === 'g') setShowGrid(g=>!g);
            if (e.key.toLowerCase() === 'f') toggleFs();
            if (e.key.toLowerCase() === 's') setShowScript(s=>!s);
            if (e.key === 'Escape' && isFs) toggleFs();
          };
          window.addEventListener('keydown', handler);
          return () => window.removeEventListener('keydown', handler);
        }, [quizMode, showGrid, isFs, toggleFs]);

        useEffect(() => {
          if (mainRef.current) mainRef.current.scrollTop = 0;
        }, [current, showGrid, quizMode]);

        const enterQuiz = useCallback(()=> {
          setQuizMode(true);
          setQuizResult(null);
        }, []);

        const exitQuizWithConfirm = useCallback(() => {
          if (safeConfirm('Exit assessment? Progress will be lost.')) {
            setQuizMode(false);
            setQuizResult(null);
          }
        }, []);

        const resetTraining = useCallback(()=> {
          setCurrent(0); setShowScript(false); setShowGrid(false); setQuizMode(false); setQuizResult(null);
        }, []);

        return (
          <div className="fixed inset-0 flex flex-col">
            <TopBar titleLabel="PIPOS v2.0" onToggleGrid={()=>setShowGrid(g=>!g)} onToggleScript={()=>setShowScript(s=>!s)} showGrid={showGrid} showScript={showScript} isFs={isFs} onToggleFs={toggleFs} slideInfo={quizMode ? 'EXAM' : `SLIDE ${current+1}/${SLIDES.length}`} />
            <div className="flex-1 flex overflow-hidden">
              <div ref={mainRef} className={`flex-1 overflow-auto ${showScript && !quizMode && !showGrid ? 'md:w-3/4' : 'w-full'}`}>
                {showGrid ? <GridOverview slides={SLIDES} current={current} onSelect={(i)=>{ setCurrent(i); setShowGrid(false); setQuizMode(false); }} enterExam={enterQuiz}/> :
                  (quizMode ? <Quiz questions={QUIZ} onFinish={(score)=>setQuizResult(score)} /> :
                    <div className="min-h-full p-4 md:p-8">
                      {SLIDES[current].type !== 'title' && <div className="mb-4 border-b border-slate-800 pb-2"><h2 className="text-2xl font-bold truncate">{SLIDES[current].title}</h2></div>}
                      <div className="bg-slate-900 p-4 rounded-lg shadow anim-fade">
                        <SlideRenderer slide={SLIDES[current]} />
                      </div>
                    </div>
                  )
                }
                {!quizMode && !showGrid && (
                  <div className="md:hidden fixed left-0 right-0 bottom-0 bg-slate-900 border-t border-slate-800 flex items-center justify-between px-4 h-16">
                    <button onClick={()=>setCurrent(c=>Math.max(c-1,0))} disabled={current===0} className="flex items-center gap-2 text-slate-400 disabled:opacity-40"><ChevronLeft/> PREV</button>
                    <div className="text-slate-400 font-mono">{current+1} / {SLIDES.length}</div>
                    <button onClick={()=>{ if (current < SLIDES.length - 1) setCurrent(c=>c+1); else enterQuiz(); }} className="flex items-center gap-2 text-cyan-400">NEXT <ChevronRight/></button>
                  </div>
                )}
              </div>

              {showScript && !quizMode && !showGrid && (
                <aside className="hidden md:block md:w-1/4 bg-slate-900 border-l border-slate-800 p-6 overflow-auto" aria-label="Speaker notes">
                  <h3 className="text-slate-400 font-bold text-xs uppercase tracking-widest mb-3">Speaker Notes</h3>
                  <p className="text-slate-200 leading-relaxed">{SLIDES[current].script}</p>
                  <div className="mt-6 p-3 bg-slate-800 rounded border border-slate-700">
                    <h4 className="text-cyan-400 text-sm font-bold mb-2">Key Emphasis</h4>
                    <ul className="list-disc list-inside text-slate-400 text-sm">
                      <li>Maintain eye contact.</li>
                      <li>Pause for emphasis.</li>
                      <li>Check audience engagement.</li>
                    </ul>
                  </div>
                </aside>
              )}
            </div>

            <footer className="hidden md:flex items-center justify-between h-8 bg-slate-900 border-t border-slate-800 px-4 text-xs text-slate-500 font-mono">
              <div>SECURE CONNECTION ESTABLISHED</div>
              <div>CONFIDENTIAL // INTERNAL USE ONLY</div>
            </footer>

            {quizResult !== null && (
              <div className="fixed inset-0 grid place-items-center bg-black/60 z-40">
                <div className={`p-6 rounded-xl max-w-lg ${quizResult === QUIZ.length ? 'bg-green-900/20 border border-green-500' : 'bg-red-900/20 border border-red-500'}`}>
                  {quizResult === QUIZ.length ? (
                    <div className="text-center">
                      <Shield className="mx-auto text-green-400" />
                      <h2 className="text-2xl font-bold text-white mt-4">CERTIFIED</h2>
                      <p className="text-green-300 mt-2">{quizResult}/{QUIZ.length}</p>
                      <button onClick={resetTraining} className="mt-4 px-4 py-2 bg-cyan-600 rounded">Finish</button>
                    </div>
                  ) : (
                    <div className="text-center">
                      <AlertTriangle className="mx-auto text-red-400" />
                      <h2 className="text-2xl font-bold text-white mt-4">ACCESS DENIED</h2>
                      <p className="text-red-300 mt-2">{quizResult}/{QUIZ.length} — 100% required</p>
                      <div className="mt-4 flex gap-2 justify-center">
                        <button onClick={()=>{ setQuizMode(true); setQuizResult(null); }} className="px-4 py-2 bg-red-600 rounded">Retry</button>
                        <button onClick={resetTraining} className="px-4 py-2 bg-slate-700 rounded">Exit</button>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    })(React, ReactDOM, window.lucideReact);
  </script>
</body>
</html>
